<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Qwik training</title>

    <link rel="stylesheet" href="../dist/reset.css">
    <link rel="stylesheet" href="../dist/reveal.css">
    <link rel="stylesheet" href="../dist/theme/white.css">
    <link rel="stylesheet" href="./slides.css">

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="../plugin/highlight/monokai.css">

    <link rel='stylesheet' id='font-family-1-css'
          href='https://fonts.googleapis.com/css2?family=Poppins%3Awght%40300%3B400%3B600%3B700&#038;display=swap&#038;ver=005bbd'
          type='text/css' media='all'/>
    <link rel="icon" type="image/png" href="./images/qwik-logo.svg">
</head>
<body class="global">

<div class="reveal">
    <div class="slides">
        <section data-state="se-connaitre">
            <h1>Qwik</h1>
            <aside class="notes">
                <ul>
                    <li>Présentation formateur</li>
                    <li>Un tour de table</li>
                    <li>Votre niveau en HTML / JS / CSS ?</li>
                    <li>Framework web JS</li>
                    <li>Chargement "instantané" quelle que soit la taille/complexité de l'application</li>
                    <li>Nécessite uniquement 1Ko de JS pour commencer à fonctionner</li>
                    <li>JSX</li>
                </ul>
            </aside>
        </section>

        <section data-state="base">
            <section>
                <h2>Qwik niveau 1</h2>
            </section>
            <section data-state="pr-robot">
                <p>Pré-requis minimums</p>
                <ul>
                    <li>Node.js 18+</li>
                    <li>NPM v10.7.0+</li>
                    <li>Git</li>
                </ul>
            </section>
            <section>
                <p>Création de l'application power ranger</p>
            </section>
            <section data-state="tp">
                <p>TP</p>
                <ul>
                    <li>Création d'une application qwik "power-rangers-app"</li>
                    <li>`npm create qwik@latest`</li>
                    <li>Nom : power-rangers-app</li>
                    <li>Starte : Empty App (Qwik City + Qwik)</li>
                    <li>Installation des dependences : oui</li>
                    <li>Initialisation du git : non</li>
                    <li>cd power-rangers-app</li>
                    <li>npm run start</li>
                </ul>
                <aside class="notes">
                    <ul>
                        <li>Correction : 01-Première-application</li>
                    </ul>
                </aside>
            </section>
            <section>
                <p>Structure du projet</p>
                <pre><code data-line-numbers="4|5|6|7|8|9|10|11|12">power-rangers-app
├─ README.md
├─ package.json
├─ public
└─ src
    ├─ components
    ├─ entry.ssr.tsx
    ├─ global.css
    ├─ root.tsx
    └─ routes
        ├─ index.tsx
        └─ layout.tsx
                </code>
                </pre>
                <aside class="notes">
                    <ul>
                        <li>README.md
                        <li>package.json
                        <li>public -> Contient des fichiers statiques qui seront copiés dans le dossier dist</li>
                        <li>src -> Contient le code de l'application</li>
                        <li>components -> Les composants qwik</li>
                        <li>entry.ssr.tsx -> Point d'entrée pour le serveur afin de générer le HTML initial de l'application avant de l'envoyer au client</li>
                        <li>global.css -> Fichier CSS global</li>
                        <li>root.tsx -> Premier composant qui sera rendu</li>
                        <li>routes -> L'annuaire des routes de l'application</li>
                        <li>index.tsx -> Page d'accueil</li>
                        <li>layout.tsx -> La mise en page racine</li>
                    </ul>
                </aside>
            </section>
            <section>
                <p>Composant et évènements</p>
                <pre>
                    <code data-trim class="code-font typescript">
                        export default component$&lt;PropsType&gt;((props) => {
                            const do = $(()=>...);
                            return &lt;button onClick$={()=>do()}&gt;Clique la&lt;button/&gt;
                        })
                    </code>
                </pre>
                <aside class="notes">
                    <ul>
                        <li>Montrer comment un composant qwik est formé</li>
                        <li>Montrer handler</li>
                    </ul>
                </aside>
            </section>
            <section data-state="tp">
                <p>TP</p>
                <ul>
                    <li class="fragment">Nettoyer la page `index.tsx`</li>
                    <li class="fragment">Créer un composant hello-world.tsx dans le dossier components et l'appeler dans ...src/routes/index.tsx</li>
                    <li class="fragment">Passer un `props` pour variabiliser le `world` selon le composant parent (ne pas oublier le typage)</li>
                    <li class="fragment">Ajouter un bouton avec un évènement onClick$ pour faire un console.log dans une
                        méthode $
                    </li>
                    <li class="fragment">👀Inspecter le navigateur👀</li>
                    <li class="fragment">Live coding</li>
                </ul>
            </section>
            <section>
                <p>Rendu avec des conditions, des listes et du binding</p>
                <ul>
                    <li class="fragment">if/else, ternaire et &&</li>
                    <li class="fragment">map et key</li>
                    <li class="fragment">Binding attribute</li>
                </ul>

            </section>
            <section>
                <pre>
                    <code data-trim class="code-font typescript" data-line-numbers="1|2|3|4|5">
                        {if(...){}else{}}
                        {condition ? ... : ...}
                        {condition && ...}
                        {[].map(()=>...)}
                        $&lt;input bind:value={...} &gt;
                    </code>
                </pre>
            </section>
            <section data-state="tp">
                <p>TP</p>
                <ul>
                    <li class="fragment">Importer SAGA_POWER_RANGERS</li>
                    <li class="fragment">Créer un composant power-ranger-list.tsx</li>
                    <li class="fragment">Faire apparaitre le nom des power rangers avec une boucle `map`</li>
                    <li class="fragment">Utiliser les balises ul li</li>
                    <li class="fragment">Ajout d'une condition d'affichage selon la couleur d'un power ranger</li>
                    <li class="fragment">Modification du filtre couleur avec un input `bind`</li>
                    <li class="fragment">Petit aide !!!</li>
                    <li class="fragment">Live coding</li>
                </ul>
            </section>

            <section>
                <p>Signal et Store</p>
                <pre>
                        <code data-trim class="code-font typescript">
                            const ... = useSignal<...>(...);
                            const ... = useStore<...>(..., { deep: boolean });
                        </code>
                    </pre>
                <aside class="notes">
                    <ul>
                        <li>Modifier dynamiquement le template</li>
                        <li>Montrer la différence</li>
                        <li>option deep permettant de suivre uniquement les propriétés de niveau supérieur, perf</li>
                    </ul>
                </aside>
            </section>
            <section data-state="tp">
                <p>TP</p>
                <ul>
                    <li class="fragment">Créer un composant dream-team.txs, l'appeler dans power-ranger-list</li>
                    <li class="fragment">Le composant DreamTeam a en props theSelection de type string</li>
                    <li class="fragment">Créer un useSignal theSelection de type string dans PowerRangerList</li>
                    <li class="fragment">Ajouter dans theSelection le nom du power ranger via un bouton, onClick$</li>
                </ul>
            </section>
            <section data-state="tp">
                <p>Suite du TP</p>
                <ul>
                    <li class="fragment">Changer theSelection par une liste de string pour en avoir plusieurs</li>
                    <li class="fragment">Utiliser les balises ul li</li>
                    <li class="fragment">👀Inspecter le navigateur👀</li>
                    <li class="fragment">Live coding</li>
                </ul>
            </section>
            <section>
                <p>CSS modules et CSS global</p>
                <p class="fragment">Le CSS global est utilisé pour les styles qui doivent être appliqués sur tout le site</p>
                <p class="fragment">Le CSS module est utilisé pour les styles qui doivent être appliqués sur un composant</p>
            </section>
            <section>
                <p>Slot</p>
                <pre>
                    <code data-trim class="code-font typescript">
                        // Composant bouton.tsx
                        export default component$(() =&gt; {

                          return (
                            &lt;&gt;
                                &lt;Slot/&gt;
                            &lt;/&gt;
                          );
                        });
                        // Utilisation dans un aure composant
                        &lt;Bouton&gt;
                            &lt;p>Clique ici&lt;/p&gt;
                        &lt;/Bouton&gt;
                    </code>
                </pre>
            </section>
            <section>
                <pre>
                    <code data-trim class="code-font typescript">
                        import style from './MyComponent.css?inline';
                        useStyles$(style);
                        useStylesScoped$(style);
                    </code>
                    </pre>
                <aside class="notes">
                    <ul>
                        <li>utilisation des css module</li>
                        <li>Importer du CSS sous forme de chaîne dans Vite, vous devez ajouter le ?inline paramètre de
                            requête à l'importation
                        </li>
                        <li>scoped</li>
                        <li>inline</li>
                    </ul>
                </aside>
            </section>
            <section data-state="tp">
                <p>TP</p>
                <ul>
                    <li class="fragment">Création d'un fichier style.css</li>
                    <li class="fragment">Personnaliser la balise ul avec `list-style-type` et la méthode useStyles$ dans PowerRangerList</li>
                    <li class="fragment">Remplacer par useStyles$ par useStylesScoped$</li>
                    <li class="fragment">👀Inspecter le navigateur👀</li>
                    <li class="fragment">Live coding</li>
                </ul>
            </section>
            <section>
                <p>Et les tests</p>
                <pre>
                        <code data-trim class="code-font typescript">
                            test(`[ExampleTest Component]: Should render`, async () => {
                              const { screen, render } = await createDOM();
                              await render(&lt;ExampleComponent /&gt;);
                              expect(screen.outerHTML).toContain(...);
                            });
                        </code>
                    </pre>
            </section>
            <section data-state="tp">
                <p>TP</p>
                <ul>
                    <li class="fragment">Installer de l'adapter vitest `npm run qwik add vitest`</li>
                    <li class="fragment">Ecrire un test pour PowerRangerDreamTeam</li>
                    <li class="fragment">Live coding</li>
                </ul>
            </section>
        </section>
        <section data-state="medium">
            <section>
                <h2>Qwik niveau 2</h2>
            </section>
            <section>
                <p>Contextes</p>
                    <pre>
                        <code data-trim class="code-font typescript">
                            // Au dessus du composant parent
                            export const contextId = createContextId&lt;Signal&lt;...&gt;&gt;(...);
                            // Dans le composant parent
                            useContextProvider(contextId, ...);
                            // Dans les composants enfants
                            const ... = useContext(contextId);
                        </code>
                    </pre>
                <aside class="notes">
                    <ul>
                        <li>Déclaration de l'id</li>
                        <li>ce qu'on peut mettre ou pas</li>
                    </ul>
                </aside>
            </section>
            <section data-state="tp">
                <p>TP</p>
                <ul>
                    <li class="fragment">Supprimer le props theSelection dans DreamTeam</li>
                    <li class="fragment">Modification PowerRangerList pour utiliser un context</li>
                    <li class="fragment">Récupération dans DreamTeam</li>
                    <li class="fragment">Live coding</li>
                </ul>
            </section>

            <section>
                <p>Qwik City - routing</p>
                <pre class="fragment">
                        <code data-trim class="code-font typescript">
                            src/
                            └── routes/
                                ├── about/
                                │   └── index.tsx # https://example.com/about
                                ├── details/
                                │   └── [id]/
                                │       └── index.tsx # https://example.com/docs/1234
                                ├── [...catchall]/
                                │   └── index.tsx # https://example.com/anything/else
                                └── layout.tsx # layout par défaut pour tous les pages
                        </code>
                    </pre>
                <aside class="notes">
                    <ul>
                        <li>Se basse sur le dossier routes</li>
                        <li>Layout serra utilisé pour les routs au même niveau</li>
                        <li>Slot permet de projeter ces enfants dans l'arborescence DOM</li>
                        <li>Récupération de données avec useLocation</li>
                    </ul>
                </aside>
            </section>
            <section data-state="tp">
                <p>TP</p>
                <ul>
                    <li class="fragment">Création d'une page `Mon power ranger`</li>
                    <li class="fragment">Accéder directement via l'url</li>
                </ul>
            </section>
            <section>
                <p>Pour récupération de la donnée passé dans l'url</p>
                <pre class="fragment">
                    <code data-trim class="code-font typescript">
                        import { useLocation } from '@builder.io/qwik-city';
                        // Dans le composant
                        const routeLocation = useLocation();
                        /*
                        routeLocation.params[...]
                        routeLocation.isNavigation
                        routeLocation.prevUrl
                        routeLocation.url
                        */
                    </code>
                </pre>
            </section>
            <section data-state="tp">
                <p>TP</p>
                <ul>
                    <li class="fragment">Création d'une page dynamique `detail` avec l'id d'une saga</li>
                    <li class="fragment">Récupérer la donnée avec SAGA_POWER_RANGERS</li>
                    <li class="fragment">Accéder directement via l'url</li>
                </ul>
            </section>
            <section>
                <p>Qwik City - Navigation SPA/MPA</p>
                <pre>
                    <code data-trim class="code-font typescript">
                        &lt;Link href=""&gt;
                            ...
                        &lt;/Link&gt;
                    </code>
                </pre>
            </section>
            <section data-state="tp">
                <p>TP</p>
                <ul>
                    <li class="fragment">Utilisation du composant `Link` pour aller sur la page `detail/[id]`</li>
                    <li class="fragment">👀Inspecter le navigateur👀</li>
                    <li class="fragment">Live coding</li>
                </ul>
            </section>
            <section>
                <p>Navigation MPA ou SPA 🧐</p>
            </section>
            <section data-state="tp">
                <p>Évènement de navigation bizarre</p>
                <p>Live coding</p>
                <aside class="notes">
                    export default component$(() => {
                    const go = $((event)=>{
                    event.preventDefault();
                    alert('tu ne pars pas')
                    })
                    return &lt;a href="http://google.com" preventdefault:click onClick$={go}&gt;Go to&lt;/a&gt;
                    }
                    )
                </aside>
            </section>
            <section>
                <p>Qwik City - DocumentHead</p>
                <pre>
                    <code data-trim class="code-font typescript">
                        // En dehors du composant
                        export const ... = routeLoader$(async (requestEvent) => {
                          return requestEvent.params...;
                        });

                        export const head: DocumentHead = ({resolveValue, params}) => {
                          const ... = resolveValue(...);
                          return {
                            title: ...,
                          };
                        };
                    </code>
                </pre>
            </section>
            <section data-state="tp">
                <p>TP</p>
                <ul>
                    <li class="fragment">Variabiliser le `title` selon le nom dans page détails d'un power rangers</li>
                    <li class="fragment">Live coding</li>
                </ul>
            </section>
            <section>
                <p>Qwik City - routeLoaders$</p>
                <pre>
                    <code data-trim class="code-font typescript">
                        // Au dessus du composant
                        export const useData = routeLoader$(async (requestEvent) => {
                          const res = await fetch(...);
                          const data = await res.json();
                          return data as ...;
                        });
                        // Dans le composant
                        const signal = useData();
                    </code>
                    </pre>
                <aside class="notes">
                    <ul>
                        <li>Récupération de donnée pour le composant ...</li>
                        <li>Ce code ne s'exécute que sur le serveur, après chaque navigation</li>
                    </ul>
                </aside>
            </section>
            <section data-state="tp">
                <p>TP</p>
                <ul>
                    <li class="fragment">Démarage du backend `node server.mjs`
                    </li>
                    <li class="fragment">Modifier le code pour récupération les données avec routeLoader$ sur
                        http://localhost:8080/
                    </li>
                    <li class="fragment">Live coding</li>
                </ul>
            </section>
            <section>
                <p>Qwik City - useResource$</p>
                <pre>
                    <code data-trim class="code-font typescript">
                        // Dans le composant
                        const resource = useResource$&lt;...&gt;(
                            async ({ track, cleanup }) => {
                            track(() => ...);
                            cleanup(() => ...);
                            const resp = await fetch(...);
                            const json = (await resp.json()) as ...;
                            return json;
                        }
                    </code>
                </pre>
            </section>
            <section>
                <p>Qwik City - Resources</p>
                <pre>
                    <code data-trim class="code-font typescript">
                        &lt;Resource
                            value={resource}
                            onPending={()=> &lt;&gt;Loading...&lt;/&gt;}
                            onRejected={()=> &lt;&gt;Erreur...&lt;/&gt;}
                            onResolved={(data) => {
                            return &lt;&gt;OK...&lt;/&gt;;
                          }}
                        &gt;
                    </code>
                </pre>
                <aside class="notes">
                    <aside class="notes">
                        <ul>
                            <li> Il est souvent souhaitable de commencer à récupérer les données sur le serveur dans le cadre de la requête HTTP initiale avant le rendu du composant</li>
                            <li>Il s'agit plutôt d'une API de bas niveau qui est utile lorsque vous souhaitez récupérer des données dans le navigateur</li>
                        </ul>
                    </aside>
                </aside>
            </section>
            <section>
                <p>TP</p>
                <ul>
                    <li class="fragment">Utilisation du composant Ressource avec le backend</li>
                    <li class="fragment">Live coding</li>
                </ul>
            </section>
            <section>
                <p>Qwik City - formulaire avec Modular Form</p>
                <pre>
                    <code data-trim class="code-font typescript" data-line-numbers="1-5|7-13|15|17-19|21-23|26-30|32-35|38-48">
                        import { $, component$, type QRL } from '@builder.io/qwik';
                        import { routeLoader$ } from '@builder.io/qwik-city';
                        import type { InitialValues, SubmitHandler } from '@modular-forms/qwik';
                        import { formAction$, useForm, valiForm$ } from '@modular-forms/qwik';
                        import * as v from 'valibot';

                        const LoginSchema = v.object({
                          email: v.pipe(
                            v.string(),
                            v.nonEmpty('Please enter your email.'),
                            v.email('The email address is badly formatted.'),
                          )
                        });

                        type LoginForm = v.InferInput&lt;typeof LoginSchema&gt;;

                        export const useFormLoader = routeLoader$&lt;InitialValues&lt;LoginForm&gt;&gt;(() =&gt; ({
                          email: '',
                        }));

                        export const useFormAction = formAction$&lt;LoginForm&gt;((values) =&gt; {
                          // Runs on server
                        }, valiForm$(LoginSchema));

                        export default component$(() =&gt; {
                          const [loginForm, { Form, Field }] = useForm&lt;LoginForm&gt;({
                            loader: useFormLoader(),
                            action: useFormAction(),
                            validate: valiForm$(LoginSchema),
                          });

                          const handleSubmit: QRL&lt;SubmitHandler&lt;LoginForm&gt;&gt; = $((values, event) =&gt; {
                            // Runs on client
                            console.log(values);
                          });

                          return (
                            &lt;Form onSubmit$={handleSubmit}&gt;
                              &lt;Field name="email"&gt;
                                {(field, props) =&gt; (
                                  &lt;div&gt;
                                    &lt;input {...props} type="email" value={field.value} /&gt;
                                    {field.error && &lt;div&gt;{field.error}&lt;/div&gt;}
                                  &lt;/div&gt;
                                )}
                              &lt;/Field&gt;
                              &lt;button type="submit"&gt;Login&lt;/button&gt;
                            &lt;/Form&gt;
                          );
                        });
                    </code>
                </pre>
            </section>
            <section>
                <p>TP</p>
                <ul>
                    <li class="fragment">Non, je blague</li>
                </ul>
            </section>
        </section>

        <section data-state="why-qwik-so-cool">
            <section>
                <h2>Les atouts de Qwik</h2>
                <p class="fragment">Pourquoi est-il aussi mé... euh cool</p>
            </section>

            <section>
                <h2>Performance Web</h2>
                <p class="fragment">... et empreinte carbone</p>
            </section>
            <section>
                <img src="./images/fcp.png" style="max-height: 400px">
                <aside class="notes">
                    <p>FP: First Painting (On commence à "sentir" de site web arriver)</p>
                    <p>FMP: First MeaningFul Painting (On peut commencer à lire, vue générale)</p>
                    <p>TTI: Time to Interactive(On peut interagir, Si l'utilisateur est resté jusque-là c'est gagné)</p>
                </aside>
            </section>
            <section>
                <img src="./images/fcp-why.png" style="height: 600px">
                <aside class="notes">
                    <div>TEMPO: 4:40</div>
                    <div>Correspond à des évènements techniques</div>
                    <div>FP: chargement de la page html uniquement</div>
                    <div>FMP: page html + rendu JS si besoin</div>
                    <div>TTI: page html + rendu JS + écouteurs dévènements</div>
                </aside>
            </section>

            <section>
                <h2>Les types de rendu web</h2>
                <aside class="notes">
                    <div>TEMPO: 6:00</div>
                    <div>Partant de ces définitions, on a utilisé dans le temps plusieurs façons de faire pour essayer
                        d'améliorer l'UX utilisateur
                    </div>
                </aside>
            </section>
            <section>
                <table class="legacy">
                    <tbody>
                    <tr>
                        <td>
                            <p>Statique</p>
                        </td>
                        <td>
                            <img src="./images/app1.png" class="app-size">
                        </td>
                        <td class="rating">
                            <div class="center-image">
                                <p>Interactivité</p>
                                <img src="./images/star.png" class="rate ml-auto">
                            </div>
                            <div class="center-image">
                                <p>FMP</p>
                                <img src="./images/star.png" class="rate ml-auto">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                            </div>
                            <div class="center-image">
                                <p>TTI</p>
                                <img src="./images/star.png" class="rate ml-auto">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                            </div>
                        </td>
                    </tr>
                    <tr class="fragment">
                        <td>
                            <p>Généré</p>
                        </td>
                        <td>
                            <img src="./images/app2.png" class="app-size">
                        </td>
                        <td class="rating">
                            <div class="center-image">
                                <p>Interactivité</p>
                                <img src="./images/star.png" class="rate ml-auto">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                            </div>
                            <div class="center-image">
                                <p>FMP</p>
                                <img src="./images/star.png" class="rate ml-auto">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                            </div>
                            <div class="center-image">
                                <p>TTI</p>
                                <img src="./images/star.png" class="rate ml-auto">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                            </div>
                        </td>
                    </tr>
                    <tr class="fragment">
                        <td>
                            <p>CSR</p>
                        </td>
                        <td>
                            <img src="./images/app3.png" class="app-size">
                        </td>
                        <td class="rating">
                            <div class="center-image">
                                <p>Interactivité</p>
                                <img src="./images/star.png" class="rate ml-auto">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                            </div>
                            <div class="center-image">
                                <p>FMP</p>
                                <img src="./images/star.png" class="rate ml-auto">
                            </div>
                            <div class="center-image">
                                <p>TTI</p>
                                <img src="./images/star.png" class="rate ml-auto">
                            </div>
                        </td>
                    </tr>
                    <tr class="fragment">
                        <td>
                            <p>SSR / (Partial) Hydratation</p>
                        </td>
                        <td>
                            <img src="./images/app4.png" class="app-size">
                        </td>
                        <td class="rating">
                            <div class="center-image">
                                <p>Interactivité</p>
                                <img src="./images/star.png" class="rate ml-auto">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                            </div>
                            <div class="center-image">
                                <p>FMP</p>
                                <img src="./images/star.png" class="rate ml-auto">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                            </div>
                            <div class="center-image">
                                <p>TTI</p>
                                <img src="./images/star.png" class="rate ml-auto">
                            </div>
                        </td>
                    </tr>
                    <tr class="fragment">
                        <td>
                            <p>SSR (Resumability) (<img src="./images/qwik.png" class="qwik-logo small">)</p>
                        </td>
                        <td>
                            <img src="./images/app5.png" class="app-size">
                        </td>
                        <td class="rating">
                            <div class="center-image">
                                <p>Interactivité</p>
                                <img src="./images/star.png" class="rate ml-auto">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                            </div>
                            <div class="center-image">
                                <p>FMP</p>
                                <img src="./images/star.png" class="rate ml-auto">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                            </div>
                            <div class="center-image">
                                <p>TTI</p>
                                <img src="./images/star.png" class="rate ml-auto">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                                <img src="./images/star.png" class="rate">
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
                <aside class="notes">
                    <h3>Statique</h3>
                    <p>Très performant, et responsable</p>
                    <p>Pas ou peu d'interactions</p>
                    <h3>Généré</h3>
                    <p>Moins bien niveau perf (il faut générer la page avant de la servir)</p>
                    <p>Plus d'interactions</p>
                    <h3>CSR</h3>
                    <p>Interactions bien supérieures</p>
                    <p>Performances "s'écroulent" FMP et TTI</p>
                    <h3>SSR avec hydratation</h3>
                    <p>Données envoyées 2 fois (HTML ET JS) et calculées 2 fois</p>
                    <p>TTI très long (reconstruction de l'ensemble de la page avant interaction même si déjà
                        constuite)</p>
                    <h3>Résumabilité</h3>
                    <p>Grosse amélioration TTI</p>
                    <p>Optimisations de ce qui est possible en plus</p>
                    <div>Do better by doing (almost) nothing !</div>
                    <div>Qwik ne demande pas d'effort au développeur !</div>
                </aside>
            </section>

            <section data-state="green">
                <h2>Empreinte et performace</h2>
                <p class="fragment fade-in">1 Mo envoyé = 15 g de CO2 (et c'est déjà un début)</p>
                <p class="fragment fade-in">Attention (activité backend, optimisations: caches, génération statique,
                    ...)</p>
                <aside class="notes">
                    <p>On a parlé jusque-là de performances, mais quel rapport avec l'empreinte carbone ?</p>
                    <p>Plus de code = plus de transit = plus de consommation</p>
                    <p>Multiplié par le nombre de visites ou d'utilisateurs</p>
                </aside>
            </section>

            <section data-state="robot">
                <h2>Résumabilité</h2>
                <p class="fragment">Relancer la navigation en exécutant le minimum de choses</p>
                <p class="fragment fade-in">Télécharger le moins de choses possible</p>
                <p class="fragment fade-in">... tout en gardant une réactivité accrue</p>
            </section>
            <section data-state="robot">
                <h2>QwikLoader</h2>
                <p class="fragment">1kB de Javascript</p>
                <p class="fragment fade-in">uniquement des handlers généraux</p>
                <p class="fragment fade-in">... uniquement ceux nécessaires</p>
            </section>
            <section data-state="robot">
                <p>Comment ça marche ?</p>
                <img src="./images/onevent.png" style="height: 250px;">
                <aside class="notes">
                    <div>Qwik ne va télécharger le JS qu'au moment où il en a besoin !</div>
                </aside>
            </section>
            <section data-state="robot">
                <img src="./images/lazy.png" style="height: 250px;">
            </section>
            <section data-state="robot">
                <h2>Le nécessaire</h2>
                <ul>
                    <li class="fragment">Etat minimisé</li>
                    <li class="fragment">Dépendances entre fragments</li>
                    <li class="fragment">Références aux interactions/render</li>
                    <li class="fragment">JS nécessaire (useVisibleTask$, ...)</li>
                </ul>
            </section>
            <section data-state="robot">
                <h2>État minimisé</h2>
                <pre data-id="code-animation">
                <code data-trim class="code-font-sm html" data-line-numbers="1|24-25,30|32-39">
                    <script type="qwik/json">{
                    "refs": {
                      "a": "0",
                      "b": "0",
                      "e": "1 6",
                      "g": "1 6"
                    },
                    "ctx": {
                      "9": {
                        "h": "7",
                        "s": "0"
                      },
                      "f": {
                        "h": "a 9!"
                      }
                    },
                    "objs": [
                      "\u00122",
                      "\u00125",
                      0,
                      "\u00110 @0",
                      "#c",
                      70,
                      "\u0002/src/counter_component_setcount_axa3vnn55qe.js#counter_component_setCount_aXA3vNn55QE[1]",
                      "\u0002/src/next_steps_component_kjctkbc9zbk.js#next_steps_component_kJCtKbc9zbk",
                      "\u00111 @1",
                      {
                        "$$value": "8"
                      },
                      "\u0002/src/gauge_component_7gzriutqs98.js#gauge_component_7gzriUtQs98"
                    ],
                    "subs": [
                      [
                        "0 #9",
                        "3 #c 3 #c"
                      ],
                      [
                        "0 #f"
                      ]
                    ]}</script>
                </code>
                </pre>
                <aside class="notes">
                    <p>Type spécifique, compris par Qwik uniquement</p>
                    <p>On devine les références au code Javascript</p>
                    <p>On devine les dépendances entre fragments</p>
                </aside>
            </section>
            <section data-state="robot">
                <p>Lisible avec <a href="https://qwik.dev/docs/labs/devtools/">Qwik Devtools</a></p>
                <pre data-id="code-animation">
                <code data-trim data-line-numbers="1-16|3-5|7" class="code-font-sm">
                        import("https://qwik.dev/devtools/json/");
                </code>
                </pre>
                <img class="fragment" src="./images/devtools.png" style="height: 250px;">
            </section>
            <section data-state="robot">
                <p>et dans le html...</p>
                <pre data-id="code-animation">
                <code data-trim data-line-numbers="1-16|3-5|7" class="code-font-sm html">
                    <script type="text/template">
                    ...
                    <main class="o-main">
                        <!--qv q:id=6 q:key=CDS6:yB_3-->
                        <!--qv q:key=8z_2-->
                        <!--qv q:id=7 q:key=8gdL:8z_0-->
                        <a href="/cart-list" preventdefault:click="" class="m-basket"
                           on:click="q-4578ff76.js#s_i1Cv0pYJNR0[0 1 1 1]" q:key="AD_1" q:id="8">
                            <!--qv q:s q:sref=7 q:key=-->
                            <i class="a-icon a-icon--basket"></i>
                            <span class="a-number">
                                <!--t=9-->0<!---->
                            </span>
                            <span class="a-label">Mon panier</span>
                            <!--/qv-->
                        </a>
                    ...
                    </main>
                    </script>
                </code>
                </pre>
                <aside class="notes">
                    <p>il utilise ses références et son markup pour le rendu</p>
                    <p>il utilise ses links js avec références pour les exécutions</p>
                    <ul>
                        <li>Le framework est responsable de ces optimisations</li>
                        <li>Uniquement la partie nécessaire de l'application est envoyée</li>
                        <li>En particulier, on n'envoie pas un contenu obtenu par API qui ne peut plus changer !</li>
                    </ul>
                </aside>
            </section>
            <section data-state="tp">
                <h2>TP</h2>
                <ul>
                    <li class="fragment">Regarder le lazy loading sur son appli</li>
                    <li class="fragment">Regarder les js générés et comment c'est articulé</li>
                </ul>
            </section>

            <section>
                <h2>Lazy Lazy loading</h2>
            </section>
            <section>
                <p>Un composant Qwik</p>
                <pre data-id="code-animation">
                <code data-trim class="code-font-sm typescript" data-line-numbers>
                    <script type="text/template">
                        import { component$ } from '@builder.io/qwik';

                        export default component$(() => {
                        console.log('render');
                        return
                        <button onClick$={() => console.log('hello')}>Hello Qwik</button>;
                        });
                    </script>
                </code>
                </pre>
                <aside class="notes">
                    <div>TEMPO: 20:25</div>
                    <div>Exemple tout simple de composant</div>
                </aside>
            </section>
            <section>
                <p>... et sa version "compilée"</p>
                <pre data-id="code-animation" style="height: 420px">
                <code data-trim class="code-font-sm typescript" data-line-numbers="1-6|8-20|22-24">
                //app.js
                import { componentQrl, qrl } from '@builder.io/qwik';
                const App = /*#__PURE__*/ componentQrl(
                    qrl(() => import('./app_component_akbu84a8zes.js'), 'App_component_AkbU84a8zes')
                );
                export { App };

                // app_component_akbu84a8zes.js
                import { jsx as _jsx } from '@builder.io/qwik/jsx-runtime';
                import { qrl } from '@builder.io/qwik';
                export const App_component_AkbU84a8zes = () => {
                    console.log('render');
                    return /*#__PURE__*/ _jsx('p', {
                        onClick$: qrl(
                        () => import('./app_component_p_onclick_01pegc10cpw'),
                            'App_component_p_onClick_01pEgC10cpw'
                        ),
                        children: 'Hello Qwik',
                    });
                };

                // app_component_p_onclick_01pegc10cpw.js
                export const App_component_p_onClick_01pEgC10cpw = () => console.log('hello');
                </code>
                </pre>
                <aside class="notes">
                    <p>Séparation en fichiers séparés</p>
                    <p>De là viennent des contraintes à respecter... (imaginons Closures, paramètres, ...)</p>
                </aside>
            </section>
            <section data-auto-animate>
                <blockquote cite="https://qwik.builder.io/docs/advanced/dollar/">
                    <p>Not all valid JavaScript code is valid code for the Optimizer.</p>
                    <footer class="code-font-sm">—Qwik documentation, <cite>The $ dollar sign</cite></footer>
                </blockquote>
                <aside class="notes">
                    <div>TEMPO: 21:25</div>
                </aside>
            </section>
            <section data-auto-animate>
                <blockquote cite="https://qwik.builder.io/docs/advanced/dollar/">
                    <p>Not all valid JavaScript code is valid code for the Optimizer.</p>
                    <footer class="code-font-sm">—Qwik documentation, <cite>The $ dollar sign</cite></footer>
                </blockquote>
                <pre data-id="code-animation">
                <code data-trim class="code-font-sm typescript" data-line-numbers>
                    <script type="text/template">
                    // Invalid
                    const foo = 'foo';
                    foo$(foo); // foo is not exported, so it's not importable

                    // Invalid
                    component$(() => {
                    let foo = 'value'; // variable is not a const
                    return
                    <div onClick$={() => console.log(foo)}/>
                    });

                    // Valid
                    export const bar = 'bar';
                    foo$(bar);

                    // Valid
                    import { bar } from './bar';
                    foo$(bar);
                    </script>
                </code>
                </pre>
                <aside class="notes">
                    <div>TEMPO: 22:25</div>
                    <p>Invalide car non exporté</p>
                    <p>Valides sinon</p>
                </aside>
            </section>
            <section data-auto-animate>
                <blockquote cite="https://qwik.builder.io/docs/advanced/dollar/">
                    <p>Not all valid JavaScript code is valid code for the Optimizer.</p>
                    <footer class="code-font-sm">—Qwik documentation, <cite>The $ dollar sign</cite></footer>
                </blockquote>
                <pre data-id="code-animation">
                <code data-trim class="code-font-sm typescript" data-line-numbers>
                    <script type="text/template">
                    // Invalid
                    component$(() => {
                    const foo = new MyCustomClass(12); // MyCustomClass is not serializable
                    return
                    <div onClick$={() => console.log(foo)}/>
                    });

                    // Valid
                    component$(() => {
                    const foo = 'value'; // ok
                    return
                    <div onClick$={() => console.log(foo)}/>
                    });
                    </script>
                </code>
                </pre>
                <aside class="notes">
                    <div>TEMPO: 23:10</div>
                    <p>Pas de let</p>
                    <p>Pas de classes (sérializable)</p>
                </aside>
            </section>

            <section>
                <h2>Dès le début ?</h2>
                <p class="fragment">useOn, useOnDocument, useOnWindow</p>
                <p class="fragment">useTask$</p>
                <p class="fragment fade-in red">useVisibleTask$</p>
                <pre class="fragment" data-id="code-animation">
                <code data-trim class="code-font-sm typescript" data-line-numbers>
                    <script type="text/template">
                    // eslint-disable-next-line qwik/no-use-visible-task
                    </script>
                </code>
                </pre>
                <aside class="notes">
                    <p>Des fois on a besoin d'exécuter des choses sans action utilisateur (slideshow, ...)</p>
                    <ul>
                        <li>useOn* permet d'écouter les évènements de chaque container directement</li>
                        <li>useTask$: exécution en mode SSR</li>
                        <li>useVisibleTask$: exécution en mode CSR, mais attention, bloque le main thread !</li>
                    </ul>
                </aside>
            </section>
            <section data-state="tp">
                <h2>TP</h2>
                <ul>
                    <li class="fragment">Ajouter un affichage de la position de la souris sur la page (coordonnées X,
                        Y)
                    </li>
                    <li class="fragment">Faire une version spéciale en utilisant un paramètre de l'url</li>
                    <li class="fragment">Rendre les TODO qui sont trop longs pour qu'ils défilent sur place</li>
                    <li class="fragment">Permettre de stopper/reprendre le défilement</li>
                </ul>
                <aside class="notes">
                    <a href="https://qwik.dev/docs/guides/best-practices/#use-usevisibletask-as-a-last-resort">Avoid
                        Visible tasks</a>
                    <ul>
                        <li class="fragment">utiliser useOnDocument</li>
                        <li class="fragment">utiliser useLocation</li>
                        <li class="fragment">useVisibleTask + un setInterval</li>
                        <li class="fragment">attention sérialisation !</li>
                    </ul>
                </aside>
            </section>
        </section>

        <section data-state="qwik-backend">
            <section>
                <h2>Qwik Backend</h2>
                <p>Tout au même endroit</p>
            </section>
            <section>
                <p>routeActions$ / globalActions$</p>
                <ul>
                    <li class="fragment">Fonctions serveur appelées explicitement</li>
                    <li class="fragment">Avec side-effect (BDD, email, submit...)</li>
                    <li class="fragment">Retourne de la donnée au client</li>
                </ul>
            </section>
            <section>
                <p>Avec un form</p>
                <pre>
                <code data-trim class="code-font-sm typescript" data-line-numbers="*|4-14|17,21-25|26-29">
                import { component$ } from '@builder.io/qwik';
                import { routeAction$, Form } from '@builder.io/qwik-city';

                export const useAddUser = routeAction$(async (data, requestEvent) => {
                    // This will only run on the server when the user submits the form (or when the action is called programmatically)
                    const userID = await db.users.add({
                        firstName: data.firstName,
                        lastName: data.lastName,
                    });
                    return {
                        success: true,
                        userID,
                    };
                });

                export default component$(() => {
                    const action = useAddUser();

                    return (
                        <>
                            <Form action={action}>
                                <input name="firstName"/>
                                <input name="lastName"/>
                                <button type="submit">Add user</button>
                            </Form>
                            {action.value?.success && (
                                // When the action is done successfully, the `action.value` property will contain the return value of the action
                                <p>User {action.value.userID} added successfully</p>
                            )}
                        </>
                        );
                });
                    </code>
                </pre>
                <aside class="notes">
                    <ul>
                        <li>npm install @modular-forms/qwik</li>
                        <li>Utilisation de Form (Qwik-City)</li>
                        <li>Fonctionnera même sans JS. Avec JS, la navigation est en mode SPA</li>
                        <li>On peut coupler avec des event handlers type onSubmitCompleted$ pour par exemple reset un
                            formulaire
                        </li>
                    </ul>
                </aside>
            </section>
            <section>
                <p>Programmatiquement</p>
                <pre>
                <code data-trim class="code-font-sm typescript" data-line-numbers="*|20-23">
                import { component$ } from '@builder.io/qwik';
                import { routeAction$, Form } from '@builder.io/qwik-city';

                export const useAddUser = routeAction$(async (data, requestEvent) => {
                    // This will only run on the server when the user submits the form (or when the action is called programmatically)
                    const userID = await db.users.add({
                        firstName: data.firstName,
                        lastName: data.lastName,
                    });
                    return {
                        success: true,
                        userID,
                    };
                });

                export default component$(() => {
                    const action = useAddUser();
                    return (
                        <section>
                            <button
                                    onClick$={async ()=> {
                                    const { value } = await action.submit({ name: 'John' });
                                    console.log(value);
                            }}
                            >
                                Add user
                            </button>
                            {action.value?.success && <p>User added successfully</p>}
                        </section>
                    );
                });
                    </code>
                </pre>
                <aside class="notes">
                    <ul>
                        <li>Pour déclencher sur ce qu'on a envie</li>
                    </ul>
                </aside>
            </section>
            <section>
                <p>Validation de formulaires</p>
                <pre>
                <code data-trim class="code-font-sm typescript" data-line-numbers="*|13-17">
                    export const useAddUser = routeAction$(
                        async (user) => {
                            // The "user" is strongly typed: { firstName: string, lastName: string }
                            const userID = await db.users.add({
                                firstName: user.firstName,
                                lastName: user.lastName,
                            });
                            return {
                                success: true,
                                userID,
                            };
                        },
                        // Zod schema is used to validate that the FormData includes "firstName" and "lastName"
                        zod$({
                            firstName: z.string(),
                            lastName: z.string(),
                        })
                    );
                </code>
                </pre>
                <aside class="notes">
                    <ul>
                        <li>Permet de valider ce qu'on a en entrée</li>
                        <li>zod est built-in dans Qwik</li>
                    </ul>
                </aside>
            </section>
            <section>
                <p>Accès à la request</p>
                <pre>
                <code data-trim class="code-font-sm typescript" data-line-numbers="*">
                    export const useProductRecommendations = routeAction$(
                        async (_data, requestEvent) => {
                            console.log('Request headers:', requestEvent.request.headers);
                            console.log('Request cookies:', requestEvent.cookie);
                            console.log('Request url:', requestEvent.url);
                            console.log('Request params:', requestEvent.params);
                            console.log('MY_ENV_VAR:', requestEvent.env.get('MY_ENV_VAR'));
                        }
                    );
                </code>
                </pre>
                <aside class="notes">
                    <ul>
                        <li>on a bien l'auth etc...</li>
                    </ul>
                </aside>
            </section>
            <section>
                <p>Gestion des erreurs</p>
                <pre>
                <code data-trim class="code-font-sm typescript" data-line-numbers="*|6|21">
                    export const useAddUser = routeAction$(
                        async (user, { fail }) => {
                            // `user` is typed { name: string }
                            const userID = await db.users.add(user);
                            if (!userID) {
                                return fail(500, { message: 'User could not be added' });
                            }
                            return { userID };
                        },
                        zod$({
                            name: z.string(),
                        })
                    );

                    export default component$(() => {
                        const action = useAddUser();
                        return (
                            <Form action={action}>
                                <input name="name"/>
                                <button type="submit">Add user</button>
                                {action.value?.failed && <p>{action.value.fieldErrors.name}</p>}
                                {action.value?.userID && <p>User added successfully</p>}
                            </Form>
                        );
                    });
                </code>
                </pre>
                <aside class="notes">
                    <ul>
                        <li>failed est mis à true en cas d'erreur</li>
                        <li>fieldErrors contient l'objet ayant provoqué l'erreur</li>
                    </ul>
                </aside>
            </section>
            <section>
                <p>Précédentes valeurs</p>
                <pre>
                <code data-trim class="code-font-sm typescript" data-line-numbers="*|9">
                    export const useAddUser = routeAction$(
                        // handle action...
                    );

                    export default component$(() => {
                        const action = useAddUser();
                        return (
                            <Form action={action}>
                                <input name="name" value={action.formData?.get('name')}/>
                                <button type="submit">Add user</button>
                            </Form>
                        );
                    });
                </code>
                </pre>
                <aside class="notes">
                    <ul>
                        <li>formData contient le précédent formulaire</li>
                        <li>par exemple si on veut persister... même sans JS</li>
                    </ul>
                </aside>
            </section>
            <section>
                <p>Route vs Global ?</p>
                <ul>
                    <li class="fragment">`routeAction$()` uniquement dans le dossier `src/routes`</li>
                    <li class="fragment">Uniquement sur les routes où elle est déclarée</li>
                    <li class="fragment">Doit être exportée</li>
                    <li class="fragment">`globalAction$()` partout dans le dossier `src`</li>
                </ul>
                <aside class="notes">
                    <ul>
                        <li>on oppose aussi souvent les actions qui ont besoin de l'utilisateur connecté ou non</li>
                        <li>routeAction$: formulaire / globalAction$: login</li>
                    </ul>
                </aside>
            </section>
            <section data-state="tp">
                <p>TP</p>
                <ul>
                    <li class="fragment">Faire en sorte de sauvegarder le contenu de notre robot dans un fichier écrit
                        dans un
                        répertoire (temporaire)
                    </li>
                </ul>
            </section>

            <section>
                <p>Middlewares</p>
                <aside class="notes">
                    <ul>
                        <li>Permet de faire de la chain logic (auth, security, cache, redirects, logging)</li>
                        <li>se déclare dans un `layout.tsx` ou `index.tsx` ou un `plugin.tsx`</li>
                    </ul>
                </aside>
            </section>
            <section>
                <p>Exemple</p>
                <pre>
                <code data-trim class="code-font-sm typescript" data-line-numbers="*">
                import type { RequestHandler } from '@builder.io/qwik-city';

                export const onRequest: RequestHandler = async ({next, url}) => {
                    console.log('Before request', url);
                    await next();
                    console.log('After request', url);
                };
                </code>
                </pre>
            </section>
            <section>
                <p>Spécifique à une méthode</p>
                <pre>
                <code data-trim class="code-font-sm typescript" data-line-numbers="*">
                    // Called only with a specific HTTP method
                    export const onGet: RequestHandler = async (requestEvent) => { ... }
                    export const onPost: RequestHandler = async (requestEvent) => { ... }
                    export const onPut: RequestHandler = async (requestEvent) => { ... }
                    export const onPatch: RequestHandler = async (requestEvent) => { ... }
                    export const onDelete: RequestHandler = async (requestEvent) => { ... }
                </code>
                </pre>
            </section>
            <section>
                <p>Ordre d'invocation</p>
                <pre>
                <code data-trim class="code-font-sm typescript" data-line-numbers="*|3|5|7">
                    src/
                    └── routes/
                        ├── layout.tsx            # Invocation order: 1 (first)
                        └── api/
                            ├── layout.tsx        # Invocation order: 2
                            └── greet/
                                └── index.ts      # Invocation order: 3 (last)
                </code>
                </pre>
                <aside class="notes">
                    <ul>
                        <li>On prends tous les layouts dans l'ordre de descente dans l'arbre</li>
                        <li>On finit par l'index.tsx feuille de la route en question</li>
                        <li>Oui, on peut avoir des endpoints dans le index.tsx qui contient un composant. Les fonctions
                            seront appelées avant le rendreing
                        </li>
                        <li>Si plusieurs middlewares dans le même fichier: onRequest, puis (onGet, onPost, onPut,
                            onPatch, et onDelete)
                        </li>
                    </ul>
                </aside>
            </section>
            <section>
                <p>RequestEvent</p>
                <pre>
                <code data-trim class="code-font-sm typescript" data-line-numbers="*|4,6,9,12">
                    import { type RequestHandler } from '@builder.io/qwik-city';

                    // Generic function `onRequest` is executed first
                    export const onRequest: RequestHandler = async ({ next, sharedMap, json }) => {
                        const log: string[] = [];
                        sharedMap.set('log', log);

                        log.push('onRequest start');
                        await next(); // Execute next middleware function (onGet)
                        log.push('onRequest end');

                        json(200, log);
                    };
                </code>
                </pre>
                <aside class="notes">
                    <ul>
                        <li>RequestEvent contient toutes sortes de fonctions utilitaires</li>
                        <li>next => passe au prochain dans la chaîne</li>
                        <li>sharedMap => rend dispo des informations</li>
                        <li>headers, cookies, method, url, params, query => self-explain</li>
                        <li>text(), html(), json(), send(), exit(), redirect() => pour gérer le retour si besoin</li>
                        <li>il y en a tout un tas: https://qwik.dev/docs/middleware/#requestevent</li>
                    </ul>
                </aside>
            </section>
            <section data-state="tp">
                <p>TP</p>
                <ul>
                    <li class="fragment">Logger tous les appels faits sur l'API</li>
                    <li class="fragment">Si tu t'ennuies: Rediriger si non authentifié sur certaines routes (non
                        corrigé)
                    </li>
                </ul>
            </section>

            <section>
                <p>Endpoints</p>

                <pre class="fragment">
                <code data-trim class="code-font-sm typescript" data-line-numbers="*">
                import { type RequestHandler } from '@builder.io/qwik-city';

                export const onGet: RequestHandler = async ({ json }) => {
                    json(200, { hello: 'world' });
                };
                </code>
                </pre>
                <aside class="notes">
                    <ul>
                        <li>C'est un middleware qui retourne une réponse</li>
                        <li>Peut accéder à une BDD pour retourner une liste, faire un reverse proxy etc...</li>
                    </ul>
                </aside>
            </section>
            <section>
                <p>Répondre progressivement</p>
                <pre>
                <code data-trim class="code-font-sm typescript" data-line-numbers="*|2-4|8,9|12,13">
                export const onGet: RequestHandler = async (requestEvent) => {
                    const writableStream = requestEvent.getWritableStream();
                    const writer = writableStream.getWriter();
                    const encoder = new TextEncoder();

                    writer.write(encoder.encode('Hello World\n'));
                    await wait(100);
                    writer.write(encoder.encode('After 100ms\n'));
                    await wait(100);
                    writer.write(encoder.encode('After 200ms\n'));
                    await wait(100);
                    writer.write(encoder.encode('END'));
                    writer.close();
                };

                const wait = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms));
                </code>
                </pre>
                <aside class="notes">
                    <ul>
                        <li>C'est un middleware qui retourne une réponse</li>
                        <li>Peut accéder à une BDD pour retourner une liste, faire un reverse proxy etc...</li>
                    </ul>
                </aside>
            </section>

            <section>
                <p>server$</p>

                <pre class="fragment">
                <code data-trim class="code-font-sm typescript" data-line-numbers="*|6-12|23-26">
                    <script type="text/template">
                import { component$, useSignal } from '@builder.io/qwik';
                import { server$ } from '@builder.io/qwik-city';

                // By wrapping a function with `server$()` we mark it to always
                // execute on the server. This is a form of RPC mechanism.
                export const serverGreeter = server$(
                function (firstName: string, lastName: string) {
                const greeting = `Hello ${firstName} ${lastName}`;
                console.log('Prints in the server', greeting);
                return greeting;
                }
                );

                export default component$(() => {
                const firstName = useSignal('');
                const lastName = useSignal('');

                return (
                <section>
                            <label>First name: <input bind:value={firstName}/></label>
                            <label>Last name: <input bind:value={lastName}/></label>

                            <button onClick$={ async ()=> {
                                        const greeting = await serverGreeter(firstName.value, lastName.value);
                                        alert(greeting);
                                } }
                                >
                                greet
                            </button>
                        </section>
                );
                });
                    </script>
                </code>
                </pre>
                <aside class="notes">
                    <ul>
                        <li>On peut aussi faire de la réponse progressive avec server$ (mais avec des fonctions
                            asynchrone génératrices (async function*, yield, ...)
                        </li>
                        <li>Endpoint est plus bas niveau - plus utile pour être une vraie API externe</li>
                        <li>server$ meilleur pour exécuter du code et le renvoyer côté client (fortement typé et
                            meilleure API pour faire ça
                        </li>
                        <li>seuls les middlewares issus de plugin.tsx sont exécutés</li>
                    </ul>
                </aside>
            </section>

            <section data-state="tp">
                <p>TP</p>
                <ul>
                    <li class="fragment">Retourner la liste des power rangers pour afficher sur une page</li>
                    <li class="fragment">Le faire progressivement apparaître toutes les 1s</li>
                </ul>
            </section>

            <section>
                <p>validator$</p>
                <pre class="fragment">
                <code data-trim class="code-font-sm typescript" data-line-numbers="*|5-7|9|11-18">
                export const useAction = routeAction$(
                    async (data, requestEvent: RequestEventAction) => {
                        return { foo: "bar" };
                    },
                    zod$(/*...*/),
                    validator$(/*...*/),
                    validator$(async (ev: RequestEvent, data) => {
                        if (ev.query.get("secret") === "123") {
                            return { success: true, data: "cool" };
                        }
                        return {
                            success: false,
                            error: {
                                message: "secret is not correct",
                                secret: ev.query.get("secret"),
                                status: 404
                            },
                        };
                    }),
                );
                </code>
                </pre>
                <aside class="notes">
                    <ul>
                        <li>Permet de valider les entrées, headers, ...</li>
                        <li>Exécutés du bas vers le haut</li>
                    </ul>
                </aside>
            </section>
            <section data-state="tp">
                <p>TP</p>
                <ul>
                    <li class="fragment">Valider que toutes les parties du robot sont bien combinées pour pouvoir le
                        sauvegarder dans le fichier
                    </li>
                </ul>
            </section>
        </section>

        <section data-state="quiz">
            <section>
                <h2>Quiz</h2>
            </section>
            <section data-quiz>
                <h3>Quel est le concept-clé de Qwik ?</h3>
                <p class="fragment green">La Résumabilité</p>
            </section>
            <section data-quiz>
                <h3>Quel est son pricipal avantage ?</h3>
                <p>Il est plus puissant</p>
                <p class="fragment highlight-green">Il est plus fainéant</p>
                <p>Il est plus intelligent</p>
                <aside class="notes">
                    Sa grande force réside dans toutes les choses qu'il évite de charger / d'exécuter
                </aside>
            </section>
            <section data-quiz>
                <h3>Ce code est-il valide ?</h3>
                <pre>
                    <code data-trim class="code-font-sm typescript">
                        <script type="text/template">
                            component$(() => {
                            const foo = new BroadcastChannel('channel');
                            return
                            <div onClick$={() => console.log(foo)}/>
                            });
                        </script>
                    </code>
                </pre>
                <p>Oui</p>
                <p class="fragment highlight-green">Non</p>
                <aside class="notes">
                    On ne peut pas sérialiser un BroadcastChannel
                </aside>
            </section>
            <section data-quiz>
                <h3>Ce code est-il valide ?</h3>
                <pre>
                    <code data-trim class="code-font-sm typescript">
                        <script type="text/template">
                            component$(() => {
                            const foo = setTimeout(() => console.log('hello'), 1000);
                            return
                            <div onClick$={() => console.log(foo)}/>
                            });
                        </script>
                    </code>
                </pre>
                <p class="fragment highlight-green">Oui</p>
                <p>Non</p>
                <p class="fragment green">
                    Mais ce n'est pas intelligent pour autant
                </p>
                <aside class="notes">
                    Alors le retour d'un setTimeout est un entier, donc techniquement sérializable.
                    Cependant, si on exécute le setTimeout côté server pour le transférer côté client...
                </aside>
            </section>
            <section data-quiz>
                <h3>Ce code peut-il être exécuté ?</h3>
                <pre>
                    <code data-trim class="code-font-sm typescript">
                        <script type="text/template">
                            useTask$(() => {
                            doSomething();
                            });
                        </script>
                    </code>
                </pre>
                <p>Côté client</p>
                <p class="fragment highlight-green">Côté serveur</p>
                <p>Les 2</p>
                <aside class="notes">
                    Use task est spécifiquement déclenché en SSR
                </aside>
            </section>
            <section data-quiz>
                <h3>Ce code peut-il être exécuté ?</h3>
                <pre>
                    <code data-trim class="code-font-sm typescript">
                        <script type="text/template">
                            useOnDocument$(() => {
                            doSomething();
                            });
                        </script>
                    </code>
                </pre>
                <p class="fragment highlight-green">Côté client</p>
                <p>Côté serveur</p>
                <p>Les 2</p>
                <aside class="notes">
                    Use on Document permet de déposer un listener sur document
                    Use Visible task attends spécifiquement l'apparition du composant dans la vue
                    Exemples: setTimeout après affichage, ...
                </aside>
            </section>
            <section data-quiz>
                <h3>Ce code peut-il être exécuté ?</h3>
                <pre>
                    <code data-trim class="code-font-sm typescript">
                        <script type="text/template">
                            export const useProductDetails = routeLoader$(async (requestEvent) => {
                            const res = await fetch(`https://.../products/${requestEvent.params.productId}`);
                            const product = await res.json();
                            return product as Product;
                            });
                        </script>
                    </code>
                </pre>
                <p>Côté client</p>
                <p class="fragment highlight-green">Côté serveur</p>
                <p>Les 2</p>
                <aside class="notes">
                    Même si on fait de la navigation côté client, cette partie reste déportée sur le serveur
                </aside>
            </section>
        </section>

        <section data-state="bonus">
            <section>
                <h2>Bonus stage</h2>
            </section>
            <section>
                <h2><a href="https://qwik.builder.io/docs/integrations/image-optimization/" target="_blank">Image
                    Optimisation</a></h2>
                <p class="fragment">Optimisation automatique et poussée des images</p>
            </section>
            <section>
                <pre data-id="code-animation">
                <code data-trim class="code-font-sm typescript" data-line-numbers="1-3|10,13">
                    <script type="text/template">
                        import ImageOnepoint from './public/images/onepoint-white.png?jsx';
                        import ImageBdxIO from './public/images/bdxio.png?jsx';
                        import type {DocumentHead} from "@builder.io/qwik-city";

                        ...

                        export default component$(() => {
                        return <>
                        <div class="onepoint">
                                    <ImageOnepoint/>
                                </div>
                        <div class="bdx-io">
                                    <ImageBdxIO/>
                                </div>
                        <Slot/>
                        </>;
                        });
                    </script>
                </code>
                </pre>
                <aside class="notes">
                    <div>import de composant avec ?jsx à la fin</div>
                    <div>Pas d'autres déclarations à faire</div>
                </aside>
            </section>
            <section>
                <pre data-id="code-animation">
                <code data-trim class="code-font-sm html" data-line-numbers="1-6,8-10">
                    <script type="text/template">
                        <img srcset="/@imagetools/68e4624f6eb399e61c972af8eeccabff0b464372 200w,
                        /@imagetools/8809c67f8779c09edd98ea4913b8405479b91a31 400w,
                        /@imagetools/ac749ebac4c3760d8527187af23e00067992402f 600w,
                        /@imagetools/649dfd42c93ba008ec3cdeba8eb3eb39a1b25611 800w"
                             width="800" height="370" decoding="async" loading="lazy" q:key="yB_0"
                             data-qwik-inspector="routes/layout.tsx:23:13">
                        ...
                        <img srcset="/@imagetools/549a200de83fc57abc50f98fbef4ed73ba7894de 200w"
                             width="200" height="200" decoding="async" loading="lazy" class="circle" q:key="yB_2"
                             data-qwik-inspector="routes/layout.tsx:29:13">
                    </script>
                </code>
                </pre>
                <aside class="notes">
                    <div>lazy load automatique</div>
                    <div>utilisation de srcset avec différentes tailles</div>
                    <div>images mises à disposition automatiquement sous différentes résolution</div>
                </aside>
            </section>
            <section>
                <h2><a href="https://qwik.dev/docs/labs/devtools/" target="_blank">DevTools</a></h2>
                <p class="fragment">Mécanisme pour éjecter les scripts tiers du temps de chargement de la page sans pour
                    autant les supprimer entièrement</p>
            </section>
            <section>
                <pre data-id="code-animation">
                <code data-trim class="code-font-sm js" data-line-numbers="1-6,8-10">
                    <script type="text/template">
                        import("https://qwik.dev/devtools/json/");
                    </script>
                </code>
                </pre>
            </section>
            <section>
                <p>Description du résultat</p>
                <ul>
                    <li class="fragment">objs: Les objects du système qui ont été sérialisés</li>
                    <li class="fragment">ctx: Un ensemble d'objets QContext.</li>
                    <li class="fragment">refs: un esemble d'objets QRef.</li>
                    <li class="fragment">sub: un ensemble d'objets QSubscription.</li>
                </ul>
                <aside class="notes">
                    <ul>
                        <li>QContext: Un état que Qwik a sérialisé pour un composant donné. Inclut les props du
                            composant et un ensemble d'objets Task qui pourraient être exécutées par le composant.
                        </li>
                        <li>QRef: Si un élément a un observateur, alors la QRef rassemble tous les observateurs ainsi
                            que les objets qui ont pu être capturés par eux.
                        </li>
                        <li>Qwik ne sérialise que les objets atteignables depuis un QContext, ou depuis une QRef.</li>
                    </ul>
                </aside>
            </section>
            <section data-state="tp">
                <p>TP</p>
                <ul>
                    <li class="fragment">Regarder l'état minimisé de votre application</li>
                </ul>
            </section>
            <section>
                <h2><a href="https://qwik.dev/docs/integrations/react/#qwik-react-%EF%B8%8F">Qwik-React</a></h2>
                <p class="fragment">Migrer depuis une application React sans tout réécrire dès le début</p>
            </section>
            <section>
                <pre data-id="code-animation">
                <code data-trim class="code-font-sm js" data-line-numbers="2|3|5-11">
                    <script type="text/template">
                // This pragma is required so that React JSX is used instead of Qwik JSX
                /** @jsxImportSource react */
                import { qwikify$ } from '@builder.io/qwik-react';

                // An existing React component
                function Greetings() {
                return
                <div>Hello from React</div>;
                }

                // Qwik component wrapping the React component
                export const QGreetings = qwikify$(Greetings);
                    </script>
                </code>
                </pre>
            </section>
            <section>
                <p>Existe aussi pour:</p>
                <ul>
                    <li class="fragment"><a href="https://github.com/QwikDev/qwik-angular">Angular</a></li>
                    <li class="fragment"><a href="https://github.com/mizchi/qwik-vue">Vue</a></li>
                </ul>
                <p class="fragment">Attention à la maturité</p>
            </section>
            <section>
                <h2><a href="https://qwik.dev/docs/integrations/#integrations">Integrations</a></h2>
                <p class="fragment">Power-ups</p>
            </section>
            <section>
                <ul>
                    <li><a href="https://qwik.dev/docs/integrations/authjs/">Auth.js</a></li>
                    <li><a href="https://qwik.dev/docs/integrations/i18n/">i18n ($localize ou qwik-speak)</a></li>
                    <li>Storybook, Tailwind, Leaflet...</li>
                </ul>
            </section>
            <section>
                <h2><a href="https://qwik.dev/docs/deployments/">Deployments</a></h2>
                <p class="fragment">Easy mode</p>
            </section>
            <section>
                <ul>
                    <li><a href="https://qwik.dev/docs/deployments/node/">Node</a></li>
                    <li><a href="https://qwik.dev/docs/deployments/static/">Static Site</a></li>
                    <li>Google Cloud Run, Deno, Bun, AWS, Firebase, ...</li>
                </ul>
            </section>
            <section>
                <h2><a href="https://qwik.dev/docs/integrations/partytown/#partytown">Partytown</a></h2>
                <p class="fragment">Mécanisme pour éjecter les scripts tiers du temps de chargement de la page sans pour
                    autant les supprimer entièrement</p>
            </section>
            <section>
                <pre data-id="code-animation">
                <code data-trim class="code-font-sm js" data-line-numbers="1|5,27,8|9-24">
                    <script type="text/template">
                    import { QwikPartytown } from './components/partytown/partytown';

                    export default component$(() => {
                    return (
                    <QwikCityProvider>
                              <head>
                                <meta charSet="utf-8"/>
                                <QwikPartytown forward={['gtag','dataLayer.push']}/>
                                <script
                                        async
                                        type="text/partytown"
                                        src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXX"
                                />
                                <script
                                        type="text/partytown"
                                        dangerouslySetInnerHTML={`
                                        window.dataLayer=window.dataLayer || [];
                                        window.gtag=function() {
                                        dataLayer.push(arguments);
                                        }
                                        gtag('js', new Date());
                                    gtag('config', 'G-XXXXXX');
                                  `}
                                />
                              </head>
                              <body lang="fr"></body>
                            </QwikCityProvider>
                    );
                    });
                    </script>
                </code>
                </pre>
            </section>
        </section>
    </div>
</div>

<script src="../dist/reveal.js"></script>
<script src="../plugin/notes/notes.js"></script>
<script src="../plugin/markdown/markdown.js"></script>
<script src="../plugin/highlight/highlight.js"></script>
<script type="module">
    import RevealGamepadController from "../plugin/reveal-gamepad-controller-plugin/dist/index.js";
    import RevealProgressImage from "../plugin/reveal-progress-image-plugin/dist/index.js";

    const urlParams = new URLSearchParams(window.location.search);
    const receiver = urlParams.get('receiver');
    const pluginOnlyOnMain = receiver !== null ? [] : [RevealGamepadController(Reveal)];

    const progressPlugin = RevealProgressImage(Reveal);

    Reveal.initialize({
        hash: true,
        progress: true,
        progressImage: {
            iconSize: [60, 60],
            imageAnimation: progressPlugin.ANIMATIONS.CIRCULAR_FLY
        },
        imageSrc: './images/lightening.png',
        plugins: [RevealMarkdown, RevealHighlight, RevealNotes, ...pluginOnlyOnMain, progressPlugin],
    });
</script>
</body>
</html>

